<html>
<head>
	<title>Weather</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
	<body>
		
		<div class="wrapper">

			<div class="sidebyside">
				<h1>Tuuli (10min)</h1>
				<p>
					Nopeus (nyt):<br>
					Suunta (nyt):<br>
					Puuska nopeus:<br>
					Nopeuden keskiarvo:<br>
					Suunnan keskiarvo:<br>
				</p>
				<h1>Muut</h1>
				<p>
					Lämpötila:<br>
					Keskilämpötila:<br>
					Kosteus:<br>
					Ilmanpaine:<br>
					Valoisuus:<br>
					Kastepiste:<br>
					Absoluuttinen kosteus:<br>
					Tuntuu kuin:<br>
				</p>
			</div>

			<div class="sidebyside">
				<h1>&nbsp;</h1>
				<p id="wind"></p>
				<h1>&nbsp;</h1>
				<p id="other"></p>
			</div>

			<div class="canvascontainer">
				<canvas width="500" height="500" id="direction"></canvas>
			</div>
		</div>

		<p class="cr">&copy; Antti.Codes 2020</p>

		<script>

			const canvas = document.getElementById('direction');
			const ctx = canvas.getContext('2d');
			const tausta = new Image();
			tausta.src = './media/tausta.png';
			const nuoli = new Image();
			nuoli.src = './media/nuoli.png';

			async function draw(degrees){
				await ctx.drawImage(tausta, 0, 0)
				await ctx.save();
			    await ctx.translate(canvas.width/2,canvas.height/2);
			    await ctx.rotate(degrees*Math.PI/180);
			    await ctx.drawImage(nuoli,-nuoli.width/2,-nuoli.width/2);
			    await ctx.restore();
			}

			async function updateData() {
			
				let data = await fetch('/api/weather');
				data = await data.json();
			
				let {
					windSpeedNow,
					windSpeedNowText,
					windDirNow,
					windDirNowText,
					windGust,
					windGustText,
					windSpeedAvg,
					windSpeedAvgText,
					windDirAvg,
					windDirAvgText,
					temperature,
					dailyTempAvg,
					humidity,
					pressure,
					lightness,
					dewPoint,
					absoluteHumidity,
					feelsLikeTemp
				} = data;

				document.getElementById('wind').innerHTML =
				`${windSpeedNowText} (${windSpeedNow} m/s)
				${windDirNowText} (${windDirNow} &#176;)
				${windGustText} (${windGust} m/s)
				${windSpeedAvgText} (${windSpeedAvg} m/s)
				${windDirAvgText} (${windDirAvg} &#176;)`
				.split('\n').join('<br>');
			
				document.getElementById('other').innerHTML =
				`${temperature} &#176;C
				${dailyTempAvg == undefined ? "Ei tarpeeksi dataa." : `${dailyTempAvg} &#176;C`}
				${humidity} %
				${pressure} hPa
				${lightness} lx
				${dewPoint} &#176;C
				${absoluteHumidity} g/m³
				${feelsLikeTemp}&#176;C`
				.split('\n').join('<br>')

				draw(windDirAvg)
			}

			updateData()
			setInterval(updateData, 2000)
		
		</script>
</body>
</html>
